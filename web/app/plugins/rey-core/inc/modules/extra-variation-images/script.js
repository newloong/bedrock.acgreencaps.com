!function(){"use strict";class a{activeVariation=null;activeVariationHash=null;lastVariationHash=null;constructor(a){this.app=a,reyParams.module_extra_variation_images&&(this.app.vars.variationHandlerType="extra",this.app.isVariationForm()&&(this.app.vars.defaultIsVariation&&(this.app.vars.shortcircut=!0,-1===["vertical","horizontal"].indexOf(this.app.options.type)&&rey.vars.is_desktop||this.app.elements.gallery.style.setProperty("--main-height",this.app.elements.mainImage.offsetHeight+"px")),this.events()))}events(){rey.jquery.addEventListener("found_variation",this.foundVariation.bind(this),this.app.elements.variationForm),rey.jquery.addEventListener("reset_data",this.resetData.bind(this),this.app.elements.variationForm),this.app.elements.variationForm.addEventListener("reycore/woocommerce/found_variation/single",this.singleVariation.bind(this))}foundVariation(a,t){this.app.debug.variationEvents&&console.log(":: foundVariation"),this.lastVariationHash=this.activeVariationHash,this.activeVariation=t,this.activeVariationHash=t.variation_images_hash,this.requestMarkup()}resetData(a,t){this.activeVariation&&(this.app.debug.variationEvents&&console.log(":: resetData"),void 0!==window.reySwatchesPreventResetData&&window.reySwatchesPreventResetData?window.reySwatchesPreventResetData=null:(this.updateMarkup(),this.activeVariation=null,this.activeVariationHash=null))}singleVariation(a){rey.jquery.trigger("found_variation",this.app.elements.variationForm,[a.detail.variation])}requestMarkup(){if(this.activeVariation&&this.activeVariationHash!==this.lastVariationHash)return 1===this.activeVariation.variation_images.length&&this.activeVariation.variation_images[0]===parseInt(this.app.options.product_main_image.id)?(this.scrollToTop(),this.updateMarkup(),void this.app.setLoading(!1)):this.app.vars.defaultIsVariation&&"undefined"!=typeof reyPDPDefaultVariationMarkup&&reyPDPDefaultVariationMarkup?(this.updateMarkup(reyPDPDefaultVariationMarkup),reyPDPDefaultVariationMarkup=null,this.app.resetDefaultVariation(),this.app.setLoading(!1),void(this.app.vars.shortcircut=!1)):(this.app.setLoading(!0),this.scrollToTop(),rey.ajax.request("get_extra_variation_images",{ss:`get_extra_variation_images_${this.activeVariation.variation_id}`,data:{count:this.activeVariation.variation_images.length,variation_id:this.activeVariation.variation_id,source:this.app.options.id},cb:a=>{if(!a.data)return this.app.setLoading(!1),void console.log(a.data);this.updateMarkup(a.data),this.app.vars.defaultIsVariation&&(this.app.resetDefaultVariation(),this.app.vars.shortcircut=!1),this.app.setLoading(!1)}}))}updateMarkup(a){if(void 0===a){if(this.app.vars.lastGalleryHTML===this.app.vars.defaultGalleryHTML)return;a=this.app.vars.defaultGalleryHTML}this.app.debug.galleryReplace&&console.log(`:: Replace gallery with ${void 0===a?"Default HTML":"Ajax Response"}.`);var t=document.createElement("div");t.innerHTML=a,this.app.vars.lastGalleryHTML=a,t.children.length||console.error("Something went wrong and there is no gallery to replace with."),this.app.elements.gallery.innerHTML=t.children[0].innerHTML,this.app.setLoading(!1),this.app.update()}scrollToTop(){reyParams.js_params.scroll_top_after_variation_change&&(rey.vars.is_desktop&&!reyParams.js_params.scroll_top_after_variation_change_desktop||window.scrollTo({behavior:"smooth",top:rey.dom.offset(this.app.elements.gallery).top-this.app.getHeaderOffset()}))}}document.addEventListener("rey/pdpGallery/beforeInit",(function(t){new a(t.detail.app)}))}();