!function(){"use strict";var e=function(){this.init=function(){this.wrapper=document.querySelector(".rey-refundsPage-orders"),this.wrapper&&(this.orderList=this.wrapper.querySelector("#order_id"),this.orderList&&(this.template=rey.template("rey-order-refund-template"),this.template&&(this.form=this.wrapper.querySelector(".woocommerce-form"),this.formBtn=this.form.querySelector("button"),this.response=this.wrapper.querySelector(".rey-refundsPage-response"),this.itemsContainer=this.wrapper.querySelector(".__items"),this.events())))},this.styleEl=function(e,t,r){e.style.opacity=t||1,e.style.pointerEvents=r||"auto"},this.events=function(){this.orderList.addEventListener("change",(e=>{this.styleEl(this.orderList,.5,"none"),rey.dom.empty(this.response),rey.dom.empty(this.itemsContainer),e.currentTarget.value?rey.ajax.request("refund_request_order_products",{data:{order:e.currentTarget.value},cb:this.populateItems}):this.styleEl(this.orderList)})),this.form.addEventListener("submit",(e=>{e.preventDefault(),this.response.classList.add("--empty"),this.response.classList.remove("--error","--success"),rey.dom.empty(this.response),this.styleEl(this.formBtn,.5,"none");var t={order:e.currentTarget.querySelector('[name="order_id"]').value,products:{}};e.currentTarget.querySelectorAll("[data-selected]").forEach(((e,r)=>{t.products[r]={},e.querySelectorAll("select, input").forEach((e=>{t.products[r][e.getAttribute("name")]=e.value}))})),rey.ajax.request("refund_request_submit",{data:t,cb:this.onSubmitResponse})})),rey.dom.delegate(this.form,"click",".__item",(e=>{e.target.closest("input")&&e.target.closest("[data-selected]")||(e.initiator.toggleAttribute("data-selected"),e.initiator.querySelectorAll("[data-required]").forEach((e=>{e.toggleAttribute("required")})))}))},this.populateItems=e=>{if(e&&e.success&&e.data){this.styleEl(this.orderList);var t=this.template({items:e.data});t&&(this.itemsContainer.innerHTML=t)}},this.onSubmitResponse=e=>{if(this.styleEl(this.formBtn),e.data){if(e.data.errors){var t="";return Object.keys(e.data.errors).forEach((r=>{t+=e.data.errors[r]})),void(""!==t&&this.makeNotice(t,"error"))}this.makeNotice(e.data,"success"),this.resetForm()}},this.resetForm=function(){this.form.reset(),rey.dom.empty(this.itemsContainer)},this.makeNotice=function(e,t){this.response.classList.add("--"+t),this.response.classList.remove("--empty","--error","--success"),this.response.innerHTML=e},this.init()};document.addEventListener("rey-DOMContentLoaded",(function(t){new e}))}();