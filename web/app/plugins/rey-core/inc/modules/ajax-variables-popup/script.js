!function(t){"use strict";var e=function(e){var a=this,i=this;this.defaultWidth=300,this.maybeCloseOverlay=!0,this.isOpen=!1,this.$parentProduct,this.init=function(){if(this.options=t.extend({$button:!1,removeInstances:!1,parentProduct:!1,productID:!1,panelWidth:!1,panelOffset:!1,pointerDir:"left"},e),this.options.removeInstances&&t(".rey-productLoop-variationsForm").remove(),this.$btn=this.options.$button,this.getParentProduct()){this.$parentProduct.addClass("--hover"),this.productId=this.options.productID||this.$btn.attr("data-product_id")||"",this.getWidthAndPosition();var i=t('.rey-productLoop-variationsForm[data-id="'+this.productId+'"]');if(i.length){this.$data=i;var o={left:"var(--half-gutter-size)",top:this.buttonOffset.top};return rey.vars.is_mobile||(o.left=this.leftPosition,o.width=this.panelWidth),i.css(o).addClass("--visible"),void a.onOpen()}this.$parentProduct.addClass("--loading --hover"),rey.ajax.request("loop_variable_product_add_to_cart",{data:{product_id:this.productId,woo_template:t("#tmpl-variation-template").length},cb:function(t){t.data?(a.onOpen(),a.getData(t)):a.$parentProduct.removeClass("--loading --hover")}})}},this.onOpen=function(){this.isOpen=!0,rey.frontend.panels.init(a.closePanel.bind(a)),rey.frontend.overlay.open("site")},this.getParentProduct=function(){return this.options.parentProduct?this.$parentProduct=this.options.parentProduct:this.$parentProduct=this.$btn.closest("li.product"),this.$parentProduct.length},this.getWidthAndPosition=function(){this.buttonOffset=this.$btn.offset(),this.panelWidth=this.options.panelWidth||this.$parentProduct.width(),this.parentOffset=this.options.panelOffset||this.$parentProduct.offset().left,this.leftPosition=this.parentOffset,this.panelWidth=Math.max(this.panelWidth,this.defaultWidth),rey.vars.is_mobile&&(this.panelWidth="calc(100vw - 30px)")},this.getData=function(e){if(this.$parentProduct.removeClass("--loading"),e.data.markup){this.$data=t(e.data.markup).appendTo(document.body),!t("#tmpl-variation-template").length&&e.data["woo-template-scripts"]&&t(e.data["woo-template-scripts"]).appendTo(document.body),void 0!==t.fn.wc_variation_form&&t(".variations_form",this.$data).each((function(){t(this).wc_variation_form()})),this.selectVariationsIfAvailable(),rey.hooks.doAction("ajax_variation_popup/after_open",this);var i={left:"var(--half-gutter-size)",top:a.buttonOffset.top};rey.vars.is_mobile||(i.left=a.leftPosition,i.width=a.panelWidth),this.$data.css(i).addClass("--visible --from-"+this.options.pointerDir),t(".variations_form",this.$data).addClass("--prevent-scroll-to-gallery"),t('.rey-qtySelect ~ input[name^="quantity"]',this.$data).remove(),this.events()}},this.events=function(){t(".rey-productLoop-variationsForm-close",this.$data).on("click",(function(t){t.preventDefault(),i.maybeCloseOverlay=!0,i.closePanel(!0)})),t(document).on("keyup",(function(t){27==t.keyCode&&i.$data.hasClass("--visible")&&(i.maybeCloseOverlay=!0,i.closePanel())})),t(document.body).on("added_to_cart",(function(t,e,a,o){i.isOpen&&(i.maybeCloseOverlay=!1),void 0!==reyParams.after_add_to_cart&&""===reyParams.after_add_to_cart&&(i.maybeCloseOverlay=!0),i.closePanel()}))},this.closePanel=function(t){(i.isOpen||t)&&(i.$parentProduct.removeClass("--hover"),i.maybeCloseOverlay&&rey.frontend.overlay.close(),rey.frontend.panels.reset(),i.$data.fadeOut("200",(function(){i.$data.removeClass("--visible").css({left:"",top:"",display:""})})),i.isOpen=!1,i.maybeCloseOverlay=!0)},this.selectVariationsIfAvailable=function(){var e=t(".rey-productVariations2 select[data-attribute_name]",this.$parentProduct);e.length&&e.each((function(e,i){var o=t(i),s=o.val();if(s){var r=o.attr("data-attribute_name");t('select[data-attribute_name="'+r+'"]',a.$data).val(s).trigger("change"),t('.rey-swatchList[data-attribute_name="'+r+'"] .rey-swatchList-item[data-term-slug="'+s+'"]',a.$data).addClass("--selected").attr("aria-checked","true")}}))},this.init()};if(reyParams.loop_ajax_variable_products){var a=[];reyParams.loop_ajax_variable_supported.forEach((function(t){a.push(".product_type_"+t+".add_to_cart_button")})),a.push(".product_type_bundle_input_required.add_to_cart_button"),t(document).on("click",a.join(", "),(function(a){var i={$button:t(a.currentTarget)};if(!i.$button.closest(".--no-var-popup").length){if(i.$button.closest(".__cart-product").length)return void 0;a.preventDefault(),new e(i)}}))}}(jQuery);